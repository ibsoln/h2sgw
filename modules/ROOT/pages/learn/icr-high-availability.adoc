= High-Availability Replication
:page-status: {release-status-sgw} -- {release-comments-sgw}
:page-edition: Under development
:page-layout: article
:page-content-type: conceptual
:page-role: panes labels
:page-aliases:
:description: Sync Gateway Concept -- high availability replication
:keywords: performan 'high availability' edge nosql api synchronization replication
// End of Page Definition Statements

include::shared-mobile::partial$_attributes-shared.adoc[]
include::partial$_attributes-local.adoc[]
:xref-pfx-sgw: {xref-pfx-sgw}:
include::partial$_page-index.adoc[]

ifeval::["{releaseStatus}" == "gamma"]
[.pane__frame--orange]
.Author's Notes
--
Document relevant aspects of _High-Availability Replication_.

Information sources include:

* Ticket: https://issues.couchbase.com/browse/DOC-6494[DOC-6494]
* https://docs.google.com/document/d/13E6JOq8u_AaUd_t8FZEPCAuq7jfkjryecjBQBHE3pG8/edit?ts=5e7cd22f#heading=h.dee3943zlt52

.Points to cover include:

* {empty}

Sync Gateway by default must support  High Availability of a replication.
While a  given replication will only run on one node at any given time but when that node fails, the system will automatically elect another node for replication.

Recommendation : To get HA, Users must be configure at least two nodes to run a given replication.

This will apply to SG-Replicate 2

Impl note: Based on set of replications defined, system will have a node election process/ heartbeat process to detect if a node is up or not)

Note : This requirement is true only for EE. In case of CE, Sync Gateway will behave as it does today. The replicator will run on the nodes that the users designate in their configuration.

In case of multiple  replications, Sync Gateway by default must distribute the set of replications across all available sync gateway nodes (on which the replications are configured). Even if a replication is configured on multiple nodes, a given replication will only run on one node at any given time.

This will apply to SG-Replicate 2

This will provide the following -
Improved throughput by distributing the replications
By ensuring that a replicator only runs on one node even if configured to run on multiple nodes, the system  redundant exchange of data as a result of redundant replications. This will reduce the processing load on the sync gateway and reduce bandwidth usage
This will allow us to deploy a truly homogenous cluster even in SG-replicate based environment where every SGW node in cluster has an identical configuration. This will enable future platform architectural enhancements around mobile manageability .

Impl note: Based on set of replications defined, system will have a node election process/ heartbeat process

Note : This requirement is true only for EE. In case of CE, Sync Gateway will behave as it does today. The replicator will run on the nodes that the users designate in their configuration. This implies that in case of a homogeneous cluster with every node having identical configuration , the replication will run on all nodes.

In EE, replications will get automatically get redistributed as more Sync Gateways are added to the cluster or removed from cluster

Expected behavior
https://docs.google.com/document/d/13E6JOq8u_AaUd_t8FZEPCAuq7jfkjryecjBQBHE3pG8/edit#heading=h.vwjngb7h5lpm
--
endif::[]

[abstract]
This content describes the concept of high-availability replication.

== About High-Availability Replication

[.pane__frame--orange]
.Author's Notes
--
Define HA as a concept and its role in replication
--

Sync Gateway supports High Availability replication. Its
{glos-term-sg-replicate2-protocol} ensures that although a given replication runs on only one node at any given time, if that node fails, the system automatically elects another node for replication. Obviously this requires that the user configure at least two nodes for any given replication.

Good becase it :

* Improves throughput by distributing the replications
By ensuring that a replicator only runs on one node even if configured to run on multiple nodes, the system  redundant exchange of data as a result of redundant replications. This will reduce the processing load on the sync gateway and reduce bandwidth usage

* Enables future platform architectural enhancements around mobile manageability . This will allow us to deploy a truly homogenous cluster even in SG-replicate based environment where every SGW node in cluster has an identical configuration.

== Node Switching

//[{tabs}]
//====
//{enterprise}::
//+
//--

[.pane__frame--orange]
.Author's Notes
--
Explain what this is, why its significant and how it is used.
--

For {enterprise} the node to run on is selected by an election process. It uses a heartbeat check to establish whether a node is up or not. If it isn't it will try the next node in the configured set.
//--

For {community} users the Sync Gateway replicator runs on the node configured by the user.


== Configuration Requirements
[.pane__frame--orange]
.Author's Notes
--
Refactor and supplement below as necessary. Include links to {xref-sgw-pg-config-properties}
--

* Configure multiple nodes for each replication required to be highly-available

* {empty}
+
--
In case of multiple  replications, Sync Gateway by default must distribute the set of replications across all available sync gateway nodes (on which the replications are configured). Even if a replication is configured on multiple nodes, a given replication will only run on one node at any given time.


This will apply to SG-Replicate 2

This will provide the following -
Improved throughput by distributing the replications
By ensuring that a replicator only runs on one node even if configured to run on multiple nodes, the system  redundant exchange of data as a result of redundant replications. This will reduce the processing load on the sync gateway and reduce bandwidth usage
This will allow us to deploy a truly homogenous cluster even in SG-replicate based environment where every SGW node in cluster has an identical configuration. This will enable future platform architectural enhancements around mobile manageability .

Impl note: Based on set of replications defined, system will have a node election process/ heartbeat process

Note : This requirement is true only for EE. In case of CE, Sync Gateway will behave as it does today. The replicator will run on the nodes that the users designate in their configuration. This implies that in case of a homogeneous cluster with every node having identical configuration , the replication will run on all nodes.
--
* {empty}
+
[.edition]
image::{enterprise}[]
+
--
In EE, replications will get automatically get redistributed as more Sync Gateways are added to the cluster or removed from cluster
--

== Examples of Expected behavior

[.pane__frame--orange]
.Author's Notes
--
Insert content based on this table here.
https://docs.google.com/document/d/13E6JOq8u_AaUd_t8FZEPCAuq7jfkjryecjBQBHE3pG8/edit#heading=h.vwjngb7h5lpm
--

[.pane__frames.cols-3]
== Related Content

.How-to ...

* include how-to links as relevant,
* include how-to links as relevant,


.Learn more ...
* {empty}
+
--
include::partial$_related-content.adoc[tags=icr]
--

.Dive Deeper ...

* Reference Material
** {xref-sgw-pg-config-properties}

include::partial$_related-content.adoc[tags=community]
